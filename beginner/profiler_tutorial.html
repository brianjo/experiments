


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>PyTorch Profiler &mdash; PyTorch Tutorials 1.7.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li class="active">
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/torchvision/">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/elastic/">
                  <span class="dropdown-title">TorchElastic</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorchâ€™s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
                <div class="version">
                  1.7.1
                </div>
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search Tutorials" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="example_tutorial.html">What is PyTorch?</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../index.html">
          
            Tutorials
          
        </a> &gt;
      </li>

        
      <li>PyTorch Profiler</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="../_sources/beginner/profiler_tutorial.rst.txt" rel="nofollow"><img src="../_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        

          <div class="pytorch-call-to-action-links">
            <div id="tutorial-type">beginner/profiler_tutorial</div>

            <div id="google-colab-link">
              <img class="call-to-action-img" src="../_static/images/pytorch-colab.svg"/>
              <div class="call-to-action-desktop-view">Run in Google Colab</div>
              <div class="call-to-action-mobile-view">Colab</div>
            </div>
            <div id="download-notebook-link">
              <img class="call-to-action-notebook-img" src="../_static/images/pytorch-download.svg"/>
              <div class="call-to-action-desktop-view">Download Notebook</div>
              <div class="call-to-action-mobile-view">Notebook</div>
            </div>
            <div id="github-view-link">
              <img class="call-to-action-img" src="../_static/images/pytorch-github.svg"/>
              <div class="call-to-action-desktop-view">View on GitHub</div>
              <div class="call-to-action-mobile-view">GitHub</div>
            </div>
          </div>

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <div class="sphx-glr-download-link-note admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Click <a class="reference internal" href="#sphx-glr-download-beginner-profiler-tutorial-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="pytorch-profiler">
<span id="sphx-glr-beginner-profiler-tutorial-py"></span><h1>PyTorch Profiler<a class="headerlink" href="#pytorch-profiler" title="Permalink to this headline">Â¶</a></h1>
<p>This recipe explains how to use PyTorch profiler and measure the time and
memory consumption of the modelâ€™s operators.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">Â¶</a></h2>
<p>PyTorch includes a simple profiler API that is useful when user needs
to determine the most expensive operators in the model.</p>
<p>In this recipe, we will use a simple Resnet model to demonstrate how to
use profiler to analyze model performance.</p>
</div>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">Â¶</a></h2>
<p>To install <code class="docutils literal notranslate"><span class="pre">torch</span></code> and <code class="docutils literal notranslate"><span class="pre">torchvision</span></code> use the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">torch</span> <span class="n">torchvision</span>
</pre></div>
</div>
</div>
<div class="section" id="steps">
<h2>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">Â¶</a></h2>
<ol class="arabic simple">
<li>Import all necessary libraries</li>
<li>Instantiate a simple Resnet model</li>
<li>Use profiler to analyze execution time</li>
<li>Use profiler to analyze memory consumption</li>
<li>Using tracing functionality</li>
</ol>
<div class="section" id="import-all-necessary-libraries">
<h3>1. Import all necessary libraries<a class="headerlink" href="#import-all-necessary-libraries" title="Permalink to this headline">Â¶</a></h3>
<p>In this recipe we will use <code class="docutils literal notranslate"><span class="pre">torch</span></code>, <code class="docutils literal notranslate"><span class="pre">torchvision.models</span></code>
and <code class="docutils literal notranslate"><span class="pre">profiler</span></code> modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torchvision.models</span> <span class="k">as</span> <span class="nn">models</span>
<span class="kn">import</span> <span class="nn">torch.autograd.profiler</span> <span class="k">as</span> <span class="nn">profiler</span>
</pre></div>
</div>
</div>
<div class="section" id="instantiate-a-simple-resnet-model">
<h3>2. Instantiate a simple Resnet model<a class="headerlink" href="#instantiate-a-simple-resnet-model" title="Permalink to this headline">Â¶</a></h3>
<p>Letâ€™s create an instance of a Resnet model and prepare an input
for it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">resnet18</span><span class="p">()</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="use-profiler-to-analyze-execution-time">
<h3>3. Use profiler to analyze execution time<a class="headerlink" href="#use-profiler-to-analyze-execution-time" title="Permalink to this headline">Â¶</a></h3>
<p>PyTorch profiler is enabled through the context manager and accepts
a number of parameters, some of the most useful are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">record_shapes</span></code> - whether to record shapes of the operator inputs;</li>
<li><code class="docutils literal notranslate"><span class="pre">profile_memory</span></code> - whether to report amount of memory consumed by
modelâ€™s Tensors;</li>
<li><code class="docutils literal notranslate"><span class="pre">use_cuda</span></code> - whether to measure execution time of CUDA kernels.</li>
</ul>
<p>Letâ€™s see how we can use profiler to analyze the execution time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">profiler</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="n">record_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">prof</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">profiler</span><span class="o">.</span><span class="n">record_function</span><span class="p">(</span><span class="s2">&quot;model_inference&quot;</span><span class="p">):</span>
        <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that we can use <code class="docutils literal notranslate"><span class="pre">record_function</span></code> context manager to label
arbitrary code ranges with user provided names
(<code class="docutils literal notranslate"><span class="pre">model_inference</span></code> is used as a label in the example above).
Profiler allows one to check which operators were called during the
execution of a code range wrapped with a profiler context manager.
If multiple profiler ranges are active at the same time (e.g. in
parallel PyTorch threads), each profiling context manager tracks only
the operators of its corresponding range.
Profiler also automatically profiles the async tasks launched
with <code class="docutils literal notranslate"><span class="pre">torch.jit._fork</span></code> and (in case of a backward pass)
the backward pass operators launched with <code class="docutils literal notranslate"><span class="pre">backward()</span></code> call.</p>
<p>Letâ€™s print out the stats for the execution above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">key_averages</span><span class="p">()</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;cpu_time_total&quot;</span><span class="p">,</span> <span class="n">row_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------
                             Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg    # of Calls
---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------
                  model_inference         1.76%       3.593ms        99.98%     204.601ms     204.601ms             1
                     aten::conv2d         0.06%     112.600us        51.01%     104.384ms       5.219ms            20
                aten::convolution         0.06%     114.900us        50.95%     104.271ms       5.214ms            20
               aten::_convolution         0.14%     288.103us        50.90%     104.156ms       5.208ms            20
         aten::mkldnn_convolution        50.64%     103.636ms        50.74%     103.833ms       5.192ms            20
                 aten::batch_norm         0.05%     105.400us        34.65%      70.908ms       3.545ms            20
     aten::_batch_norm_impl_index         0.07%     138.400us        34.60%      70.803ms       3.540ms            20
          aten::native_batch_norm        22.38%      45.807ms        34.50%      70.597ms       3.530ms            20
                     aten::select         9.24%      18.903ms        11.19%      22.895ms       3.180us          7200
                 aten::max_pool2d         0.01%      15.800us        10.65%      21.799ms      21.799ms             1
---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 204.648ms
</pre></div>
</div>
<p>The output will look like (omitting some columns):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -------------------------  --------------  ----------  ------------  ---------</span>
<span class="c1"># Name                       Self CPU total   CPU total  CPU time avg  # Calls</span>
<span class="c1"># -------------------------  --------------  ----------  ------------  ---------</span>
<span class="c1"># model_inference            3.541ms         69.571ms    69.571ms      1</span>
<span class="c1"># conv2d                     69.122us        40.556ms    2.028ms       20</span>
<span class="c1"># convolution                79.100us        40.487ms    2.024ms       20</span>
<span class="c1"># _convolution               349.533us       40.408ms    2.020ms       20</span>
<span class="c1"># mkldnn_convolution         39.822ms        39.988ms    1.999ms       20</span>
<span class="c1"># batch_norm                 105.559us       15.523ms    776.134us     20</span>
<span class="c1"># _batch_norm_impl_index     103.697us       15.417ms    770.856us     20</span>
<span class="c1"># native_batch_norm          9.387ms         15.249ms    762.471us     20</span>
<span class="c1"># max_pool2d                 29.400us        7.200ms     7.200ms       1</span>
<span class="c1"># max_pool2d_with_indices    7.154ms         7.170ms     7.170ms       1</span>
<span class="c1"># -------------------------  --------------  ----------  ------------  ---------</span>
</pre></div>
</div>
<p>Here we see that, as expected, most of the time is spent in convolution (and specifically in <code class="docutils literal notranslate"><span class="pre">mkldnn_convolution</span></code>
for PyTorch compiled with MKL-DNN support).
Note the difference between self cpu time and cpu time - operators can call other operators, self cpu time exludes time
spent in children operator calls, while total cpu time includes it.</p>
<p>To get a finer granularity of results and include operator input shapes, pass <code class="docutils literal notranslate"><span class="pre">group_by_input_shape=True</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">key_averages</span><span class="p">(</span><span class="n">group_by_input_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;cpu_time_total&quot;</span><span class="p">,</span> <span class="n">row_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># (omitting some columns)</span>
<span class="c1"># -------------------------  -----------  --------  -------------------------------------</span>
<span class="c1"># Name                       CPU total    # Calls         Input Shapes</span>
<span class="c1"># -------------------------  -----------  --------  -------------------------------------</span>
<span class="c1"># model_inference            69.571ms     1         []</span>
<span class="c1"># conv2d                     9.019ms      4         [[5, 64, 56, 56], [64, 64, 3, 3], []]</span>
<span class="c1"># convolution                9.006ms      4         [[5, 64, 56, 56], [64, 64, 3, 3], []]</span>
<span class="c1"># _convolution               8.982ms      4         [[5, 64, 56, 56], [64, 64, 3, 3], []]</span>
<span class="c1"># mkldnn_convolution         8.894ms      4         [[5, 64, 56, 56], [64, 64, 3, 3], []]</span>
<span class="c1"># max_pool2d                 7.200ms      1         [[5, 64, 112, 112]]</span>
<span class="c1"># conv2d                     7.189ms      3         [[5, 512, 7, 7], [512, 512, 3, 3], []]</span>
<span class="c1"># convolution                7.180ms      3         [[5, 512, 7, 7], [512, 512, 3, 3], []]</span>
<span class="c1"># _convolution               7.171ms      3         [[5, 512, 7, 7], [512, 512, 3, 3], []]</span>
<span class="c1"># max_pool2d_with_indices    7.170ms      1         [[5, 64, 112, 112]]</span>
<span class="c1"># -------------------------  -----------  --------  --------------------------------------</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ---------------------------------------------
                             Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg    # of Calls                                   Input Shapes
---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ---------------------------------------------
                  model_inference         1.76%       3.593ms        99.98%     204.601ms     204.601ms             1                                             []
                     aten::conv2d         0.01%      25.700us        14.18%      29.012ms       7.253ms             4  [[5, 64, 56, 56], [64, 64, 3, 3], [], [], [],
                aten::convolution         0.01%      28.500us        14.16%      28.986ms       7.247ms             4  [[5, 64, 56, 56], [64, 64, 3, 3], [], [], [],
               aten::_convolution         0.04%      74.900us        14.15%      28.958ms       7.239ms             4  [[5, 64, 56, 56], [64, 64, 3, 3], [], [], [],
         aten::mkldnn_convolution        14.08%      28.823ms        14.11%      28.875ms       7.219ms             4  [[5, 64, 56, 56], [64, 64, 3, 3], [], [], [],
                 aten::max_pool2d         0.01%      15.800us        10.65%      21.799ms      21.799ms             1        [[5, 64, 112, 112], [], [], [], [], []]
    aten::max_pool2d_with_indices        10.63%      21.760ms        10.64%      21.783ms      21.783ms             1        [[5, 64, 112, 112], [], [], [], [], []]
                 aten::batch_norm         0.01%      21.600us        10.55%      21.591ms       4.318ms             5  [[5, 512, 7, 7], [512], [512], [512], [512],
     aten::_batch_norm_impl_index         0.01%      29.700us        10.54%      21.569ms       4.314ms             5  [[5, 512, 7, 7], [512], [512], [512], [512],
          aten::native_batch_norm         4.61%       9.444ms        10.52%      21.520ms       4.304ms             5  [[5, 512, 7, 7], [512], [512], [512], [512],
---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ---------------------------------------------
Self CPU time total: 204.648ms
</pre></div>
</div>
</div>
<div class="section" id="use-profiler-to-analyze-memory-consumption">
<h3>4. Use profiler to analyze memory consumption<a class="headerlink" href="#use-profiler-to-analyze-memory-consumption" title="Permalink to this headline">Â¶</a></h3>
<p>PyTorch profiler can also show the amount of memory (used by the modelâ€™s tensors)
that was allocated (or released) during the execution of the modelâ€™s operators.
In the output below, â€˜selfâ€™ memory corresponds to the memory allocated (released)
by the operator, excluding the children calls to the other operators.
To enable memory profiling functionality pass <code class="docutils literal notranslate"><span class="pre">profile_memory=True</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">profiler</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="n">profile_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">record_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">prof</span><span class="p">:</span>
    <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">key_averages</span><span class="p">()</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;self_cpu_memory_usage&quot;</span><span class="p">,</span> <span class="n">row_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># (omitting some columns)</span>
<span class="c1"># ---------------------------  ---------------  ---------------  ---------------</span>
<span class="c1"># Name                         CPU Mem          Self CPU Mem     Number of Calls</span>
<span class="c1"># ---------------------------  ---------------  ---------------  ---------------</span>
<span class="c1"># empty                        94.79 Mb         94.79 Mb         123</span>
<span class="c1"># resize_                      11.48 Mb         11.48 Mb         2</span>
<span class="c1"># addmm                        19.53 Kb         19.53 Kb         1</span>
<span class="c1"># empty_strided                4 b              4 b              1</span>
<span class="c1"># conv2d                       47.37 Mb         0 b              20</span>
<span class="c1"># ---------------------------  ---------------  ---------------  ---------------</span>

<span class="nb">print</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">key_averages</span><span class="p">()</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;cpu_memory_usage&quot;</span><span class="p">,</span> <span class="n">row_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># (omitting some columns)</span>
<span class="c1"># ---------------------------  ---------------  ---------------  ---------------</span>
<span class="c1"># Name                         CPU Mem          Self CPU Mem     Number of Calls</span>
<span class="c1"># ---------------------------  ---------------  ---------------  ---------------</span>
<span class="c1"># empty                        94.79 Mb         94.79 Mb         123</span>
<span class="c1"># batch_norm                   47.41 Mb         0 b              20</span>
<span class="c1"># _batch_norm_impl_index       47.41 Mb         0 b              20</span>
<span class="c1"># native_batch_norm            47.41 Mb         0 b              20</span>
<span class="c1"># conv2d                       47.37 Mb         0 b              20</span>
<span class="c1"># convolution                  47.37 Mb         0 b              20</span>
<span class="c1"># _convolution                 47.37 Mb         0 b              20</span>
<span class="c1"># mkldnn_convolution           47.37 Mb         0 b              20</span>
<span class="c1"># empty_like                   47.37 Mb         0 b              20</span>
<span class="c1"># max_pool2d                   11.48 Mb         0 b              1</span>
<span class="c1"># max_pool2d_with_indices      11.48 Mb         0 b              1</span>
<span class="c1"># resize_                      11.48 Mb         11.48 Mb         2</span>
<span class="c1"># addmm                        19.53 Kb         19.53 Kb         1</span>
<span class="c1"># adaptive_avg_pool2d          10.00 Kb         0 b              1</span>
<span class="c1"># mean                         10.00 Kb         0 b              1</span>
<span class="c1"># ---------------------------  ---------------  ---------------  ---------------</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                             Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg       CPU Mem  Self CPU Mem    # of Calls
---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                      aten::empty         0.22%     359.404us         0.22%     359.404us       2.898us      94.79 Mb      94.79 Mb           124
                    aten::resize_         0.01%       9.300us         0.01%       9.300us       4.650us      11.48 Mb      11.48 Mb             2
                      aten::addmm         0.14%     231.702us         0.15%     246.602us     246.602us      19.53 Kb      19.53 Kb             1
              aten::empty_strided         0.00%       2.700us         0.00%       2.700us       2.700us           4 b           4 b             1
                     aten::conv2d         0.07%     115.200us        47.85%      78.593ms       3.930ms      47.37 Mb           0 b            20
                aten::convolution         0.07%     111.800us        47.78%      78.478ms       3.924ms      47.37 Mb           0 b            20
               aten::_convolution         0.17%     280.003us        47.71%      78.366ms       3.918ms      47.37 Mb           0 b            20
                 aten::contiguous         0.02%      27.900us         0.02%      27.900us       0.680us           0 b           0 b            41
         aten::mkldnn_convolution        47.44%      77.915ms        47.53%      78.060ms       3.903ms      47.37 Mb           0 b            20
                aten::as_strided_         0.02%      39.200us         0.02%      39.200us       1.960us           0 b           0 b            20
---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 164.241ms

---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                             Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg       CPU Mem  Self CPU Mem    # of Calls
---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
                      aten::empty         0.22%     359.404us         0.22%     359.404us       2.898us      94.79 Mb      94.79 Mb           124
                 aten::batch_norm         0.05%      88.700us        37.82%      62.111ms       3.106ms      47.41 Mb           0 b            20
     aten::_batch_norm_impl_index         0.08%     126.801us        37.76%      62.022ms       3.101ms      47.41 Mb           0 b            20
          aten::native_batch_norm        24.07%      39.540ms        37.65%      61.832ms       3.092ms      47.41 Mb           0 b            20
                     aten::conv2d         0.07%     115.200us        47.85%      78.593ms       3.930ms      47.37 Mb           0 b            20
                aten::convolution         0.07%     111.800us        47.78%      78.478ms       3.924ms      47.37 Mb           0 b            20
               aten::_convolution         0.17%     280.003us        47.71%      78.366ms       3.918ms      47.37 Mb           0 b            20
         aten::mkldnn_convolution        47.44%      77.915ms        47.53%      78.060ms       3.903ms      47.37 Mb           0 b            20
                 aten::empty_like         0.04%      73.000us         0.08%     132.801us       6.640us      47.37 Mb           0 b            20
                 aten::max_pool2d         0.00%       7.500us        12.06%      19.805ms      19.805ms      11.48 Mb           0 b             1
---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------
Self CPU time total: 164.241ms
</pre></div>
</div>
</div>
<div class="section" id="using-tracing-functionality">
<h3>5. Using tracing functionality<a class="headerlink" href="#using-tracing-functionality" title="Permalink to this headline">Â¶</a></h3>
<p>Profiling results can be outputted as a .json trace file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">profiler</span><span class="o">.</span><span class="n">profile</span><span class="p">()</span> <span class="k">as</span> <span class="n">prof</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">profiler</span><span class="o">.</span><span class="n">record_function</span><span class="p">(</span><span class="s2">&quot;model_inference&quot;</span><span class="p">):</span>
        <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">prof</span><span class="o">.</span><span class="n">export_chrome_trace</span><span class="p">(</span><span class="s2">&quot;trace.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>User can examine the sequence of profiled operators after loading the trace file
in Chrome (<code class="docutils literal notranslate"><span class="pre">chrome://tracing</span></code>):</p>
<a class="reference internal image-reference" href="beginner/../../_static/img/trace_img.png"><img alt="beginner/../../_static/img/trace_img.png" src="beginner/../../_static/img/trace_img.png" /></a>
</div>
</div>
<div class="section" id="learn-more">
<h2>Learn More<a class="headerlink" href="#learn-more" title="Permalink to this headline">Â¶</a></h2>
<p>Take a look at the following recipes/tutorials to continue your learning:</p>
<ul class="simple">
<li><a class="reference external" href="https://pytorch.org/tutorials/recipes/recipes/benchmark.html">PyTorch Benchmark</a></li>
<li><a class="reference external" href="https://pytorch.org/tutorials/intermediate/tensorboard_tutorial.html">Visualizing models, data, and training with TensorBoard</a> tutorial</li>
</ul>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  2.674 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-beginner-profiler-tutorial-py">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../_downloads/840ca38c61d5c01b590641d98309aace/profiler_tutorial.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">profiler_tutorial.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../_downloads/b8134c638afef961bd44dd26eab1f98f/profiler_tutorial.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">profiler_tutorial.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


             </article>
             
            </div>
            <footer>
  

  

    <hr class="helpful-hr hr-top">
      <div class="helpful-container">
        <div class="helpful-question">Was this helpful?</div>
        <div class="helpful-question yes-link" data-behavior="was-this-helpful-event" data-response="yes">Yes</div>
        <div class="helpful-question no-link" data-behavior="was-this-helpful-event" data-response="no">No</div>
        <div class="was-helpful-thank-you">Thank you</div>
      </div>
    <hr class="helpful-hr hr-bottom"/>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, PyTorch.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">PyTorch Profiler</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#steps">Steps</a><ul>
<li><a class="reference internal" href="#import-all-necessary-libraries">1. Import all necessary libraries</a></li>
<li><a class="reference internal" href="#instantiate-a-simple-resnet-model">2. Instantiate a simple Resnet model</a></li>
<li><a class="reference internal" href="#use-profiler-to-analyze-execution-time">3. Use profiler to analyze execution time</a></li>
<li><a class="reference internal" href="#use-profiler-to-analyze-memory-consumption">4. Use profiler to analyze memory consumption</a></li>
<li><a class="reference internal" href="#using-tracing-functionality">5. Using tracing functionality</a></li>
</ul>
</li>
<li><a class="reference internal" href="#learn-more">Learn More</a></li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
         <script type="text/javascript" src="../_static/jquery.js"></script>
         <script type="text/javascript" src="../_static/underscore.js"></script>
         <script type="text/javascript" src="../_static/doctools.js"></script>
         <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
     

  

  <script type="text/javascript" src="../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-90545585-2', 'auto');
  ga('send', 'pageview');

</script>


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col follow-us-col">
          <ul>
            <li class="list-title">Stay Connected</li>
            <li>
              <div id="mc_embed_signup">
                <form
                  action="https://twitter.us14.list-manage.com/subscribe/post?u=75419c71fe0a935e53dfa4a3f&id=91d0dccd39"
                  method="post"
                  id="mc-embedded-subscribe-form"
                  name="mc-embedded-subscribe-form"
                  class="email-subscribe-form validate"
                  target="_blank"
                  novalidate>
                  <div id="mc_embed_signup_scroll" class="email-subscribe-form-fields-wrapper">
                    <div class="mc-field-group">
                      <label for="mce-EMAIL" style="display:none;">Email Address</label>
                      <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
                    </div>

                    <div id="mce-responses" class="clear">
                      <div class="response" id="mce-error-response" style="display:none"></div>
                      <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_75419c71fe0a935e53dfa4a3f_91d0dccd39" tabindex="-1" value=""></div>

                    <div class="clear">
                      <input type="submit" value="" name="subscribe" id="mc-embedded-subscribe" class="button email-subscribe-button">
                    </div>
                  </div>
                </form>
              </div>

            </li>
          </ul>

          <div class="footer-social-icons">
            <a href="https://www.facebook.com/pytorch" target="_blank" class="facebook"></a>
            <a href="https://twitter.com/pytorch" target="_blank" class="twitter"></a>
            <a href="https://www.youtube.com/pytorch" target="_blank" class="youtube"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebookâ€™s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/hub">PyTorch Hub</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li class="active">
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/docs/stable/torchvision/">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/elastic/">TorchElastic</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>